# 📋 CHANGELOG

## [1.0.0] - 2025-08-16

### ✨ 新增特性

#### 🔊 多引擎 TTS 语音系统
- **三引擎架构**：新增 OpenXing TTS 主引擎，t.leftsite.cn 备用引擎，浏览器 Web Speech API 兜底
- **智能故障转移**：自动检测服务可用性，服务不可用时自动降级
- **29+ 中文语音**：支持丰富的语音选择，包含情感风格和性别选项
- **语音试听功能**：提供语音预览和实时切换
- **高级 TTS 功能**：
  - 句子级阅读和可视化高亮
  - 实时进度跟踪和动画进度条
  - 自动滚动，可配置速度和平滑滚动
  - 跨章节连续阅读

#### 👤 完整用户系统
- **个人中心重构**：全新设计的个人资料管理界面
- **用户信息展示**：头像、VIP 状态、成就徽章显示
- **阅读统计**：详细的阅读数据分析和可视化
  - 阅读时长、书籍数量、字数统计
  - 连续阅读天数和成就系统
  - 今日、本周、总计数据对比
- **安全登录系统**：
  - Server-Sent Events 实时登录状态更新
  - 完整用户数据获取和存储
  - 头像信息在 SSE 响应中提供
- **安全退出功能**：
  - 服务端会话清理（KV 存储）
  - 客户端状态重置
  - 确认对话框和加载状态
  - 支持快速退出和完整退出模式

#### 📊 数据管理优化
- **仪表板重构**：新增详细的阅读数据统计和趋势分析
- **个人阅读报告**：成就系统和里程碑展示
- **阅读热力图**：时间分布分析和分类统计
- **作者偏好分析**：个性化阅读推荐基础

#### 🔍 内容发现系统
- **统一搜索接口**：支持全局搜索和搜索建议
  - 混合搜索（全局结果+建议）
  - 仅全局搜索（内容片段）
  - 仅搜索建议
  - 可配置返回数量（最大20条）
- **书架管理**：个人图书收藏和分类
- **笔记系统**：支持笔记、书签、书评 CRUD 操作
- **进度同步**：跨设备阅读进度同步

### 🔧 技术改进

#### 🎨 CSS 生产环境优化
- **解决样式丢失问题**：修复生产环境下 CSS 样式丢失的关键问题
- **外部样式表**：将所有内联样式迁移到 `static/styles.css`
- **TailwindCSS 配置优化**：
  - 添加 safelist 防止重要类被 purge
  - 扩展主题配置和自定义动画
  - 优化构建脚本，确保生产环境 CSS 正确处理
- **移除内联样式**：从 `dangerouslySetInnerHTML` 迁移到外部 CSS 类
- **CSS 构建工具**：集成 TailwindCSS 生产构建和压缩

#### 💾 数据存储完整性
- **修复登录 SSE 数据存储**：
  - 存储完整的微信读书 API 响应数据
  - 包含原始数据、转换数据和个人资料数据
  - 头像信息现在正确存储和传输
- **用户 API 优化**：优先使用 KV 缓存数据，减少 API 调用
- **会话管理**：改进的 token 认证和用户凭证系统

#### 🔄 API 架构升级
- **RESTful 设计**：统一的 API 设计原则和错误处理
- **CORS 支持**：所有端点支持跨域请求
- **Token 认证**：支持 URL 参数和 Authorization header
- **错误处理**：统一的错误响应格式

#### 🏗️ 组件架构优化
- **共享工具函数**：创建 `utils/logout.ts` 统一退出逻辑
- **组件解耦**：移除组件间的直接依赖
- **状态管理**：优化 Preact Signals 使用模式
- **类型安全**：完善 TypeScript 类型定义

### 🐛 问题修复

#### 🎨 样式相关
- 修复生产环境下 CSS 样式丢失问题
- 修复内联样式在 Fresh 生产模式下不工作的问题
- 修复 TailwindCSS 类名被意外 purge 的问题
- 修复动画和过渡效果在生产环境的显示问题

#### 💾 数据相关
- 修复登录 SSE 存储不完整用户信息的问题
- 修复用户头像在某些情况下不显示的问题
- 修复会话管理和 token 验证的边界情况
- 修复 KV 存储的数据结构不一致问题

#### 🔧 功能相关
- 修复退出登录后用户状态残留的问题
- 修复 TTS 服务不可用时的错误处理
- 修复组件状态更新的时序问题
- 修复登录过期错误处理与用户体验

### 📚 文档更新

#### 📖 开发文档
- **CLAUDE.md 大幅更新**：
  - 完整的开发命令和代码质量检查指南
  - 详细的架构概览和技术栈说明
  - 核心功能模块和 API 端点文档
  - TTS 实现细节和开发注意事项
  - 性能优化和故障排除指南

#### 📋 项目说明
- **README.md 重构**：
  - 更新项目特性和技术栈信息
  - 完善安装使用和开发指南
  - 详细的 API 端点和组件说明
  - 最新的项目状态和路线图
  - 新增 MVP 说明和成本估算
  - 使用折叠语法优化文档结构

#### 🔧 故障排除
- **CSS-FIX-GUIDE.md**：CSS 样式问题解决方案文档
- **部署检查清单**：生产环境部署验证步骤
- **技术实现说明**：修复的文件和具体改动

### 🚀 性能优化

#### ⚡ 加载性能
- 优化 CSS 构建流程，减少样式文件大小
- 改进 TTS 服务的启动和响应时间
- 优化用户数据获取的缓存策略

#### 🔄 运行时性能
- 减少不必要的 API 调用
- 优化组件渲染和状态更新
- 改进内存使用和垃圾回收

#### 📱 用户体验
- 添加加载状态和错误提示
- 改进响应式设计和移动端适配
- 优化交互反馈和动画效果

---

## [0.1.0] - 2025-08-14

### ✨ 初始化版本

#### 🎯 项目基础
- **项目初始化**：创建基于 Fresh 1.7.3 的 Deno 项目
- **基础配置**：配置 TailwindCSS 3.4.0 和 Preact 10.22.0
- **开发环境**：设置开发和构建脚本
- **路由系统**：实现基于文件的路由结构
- **组件架构**：建立 Islands 组件和页面结构

---

**完整的 git commit 记录：**
- `1eec013` - feat(login): 完善登录过期错误处理与用户体验优化
- `5500eff` - feat(tts): 优化文本转语音功能  
- `f6e42ca` - feat(islands): 添加语音试听功能并优化 TTS 设置
- `d76735f` - feat(css): 整合组件内联样式到CSS文件并添加缺失的样式类
- `13d9ec5` - feat(profile&perf): 完善退出登录功能并优化性能
- `abd1f21` - feat: 初始化 Fresh 项目

---

## 版本说明

- **主版本号（Major）**：重大架构变更或破坏性更新
- **次版本号（Minor）**：新功能添加，向后兼容
- **修订号（Patch）**：问题修复，向后兼容

## 贡献指南

欢迎提交 Issue 和 Pull Request 来帮助改进项目。请查看 [CONTRIBUTING.md](CONTRIBUTING.md) 了解详细的贡献指南。

---

🔗 **相关链接：**
- [项目仓库](https://github.com/h7ml/weread)
- [在线演示](https://webook.linuxcloudlab.com/)
- [问题反馈](https://github.com/h7ml/weread/issues)
- [开发文档](CLAUDE.md)